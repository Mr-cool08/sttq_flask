<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STT + Diarisering (HQ)</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <div class="card">
    <h1>Transkribera ljud/video med talar-diarisering</h1>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for m in messages %}<div class="flash">{{ m }}</div>{% endfor %}
      {% endif %}
    {% endwith %}

    <form id="transcribe-form" action="{{ url_for('transcribe_route') }}" method="post" enctype="multipart/form-data">
      <!-- Filuppladdning -->
      <p>
        <label for="file">Fil att ladda upp</label><br>
        <input id="file" type="file" name="file" required>
        <small class="help">Stöd för ljud- och videofiler (t.ex. .wav, .mp3, .mp4). Används som underlag för transkribering.</small>
      </p>

      <div class="row">
        <!-- Språk -->
        <p>
          <label for="language">Språk (ISO, t.ex. sv) – lämna tomt för auto</label>
          <input id="language" type="text" name="language" placeholder="sv">
          <small class="help">Lämna tomt för automatisk språkidentifiering.</small>
        </p>

        <!-- Modell -->
        <p>
          <label for="model">Modell</label>
          <select id="model" name="model">
            <option value="large-v3" selected>large-v3 (högst kvalitet)</option>
            <option value="medium">medium</option>
            <option value="small">small</option>
            <option value="base">base</option>
            <option value="tiny">tiny</option>
          </select>
          <small class="help">Större modeller är noggrannare men tar längre tid.</small>
        </p>
      </div>

      <div class="row3">
        <!-- Chunk-längd -->
        <p>
          <label for="chunk_length">Chunk-längd (sek)</label>
          <input id="chunk_length" type="number" name="chunk_length" min="10" max="120" value="45">
          <small class="help">Delar upp ljudet i bitar. Längre = mer sammanhang men högre minneskrav.</small>
        </p>

        <!-- Assign-strategi -->
        <p>
          <label for="assign_strategy">Assign-strategi</label>
          <select id="assign_strategy" name="assign_strategy">
            <option value="primary" selected>primary</option>
            <option value="split">split</option>
          </select>
          <small class="help">primary = hela segmentet får en talare. split = delar upp segment om flera talare talar.</small>
        </p>

        <!-- Merge gap -->
        <p>
          <label for="merge_gap">Merge gap (sek)</label>
          <input id="merge_gap" type="number" step="0.1" name="merge_gap" value="0.5">
          <small class="help">Tid i sekunder för att slå ihop segment från samma talare.</small>
        </p>
      </div>

      <!-- Hotwords -->
      <p>
        <label for="hotwords">Hotwords (komma-separerade)</label>
        <input id="hotwords" type="text" name="hotwords" placeholder="balis,ATC,ERTMS,axellast,växelvärme,spårvidd">
        <small class="help">Ord som systemet prioriterar extra (t.ex. tekniska termer).</small>
      </p>
      <label>Förbehandling</label>
      <div class="row3">
        <!-- Loudnorm -->
        <p class="checkbox">
          <input id="loudnorm" type="checkbox" name="loudnorm" value="1">
          <label for="loudnorm">EBU R128 loudnorm</label>
          <small class="help">Jämnar ut volymnivåer för tydligare tal.</small>
        </p>

        <!-- Denoise -->
        <p class="checkbox">
          <input id="denoise" type="checkbox" name="denoise" value="1">
          <label for="denoise">Lätt denoise</label>
          <small class="help">Minskar bakgrundsbrus – bra vid bullriga inspelningar.</small>
        </p>

        <!-- Diarisering -->
        <p class="checkbox">
          <input id="do_diarize" type="checkbox" name="do_diarize" value="1" checked>
          <label for="do_diarize">Aktivera diarization</label>
          <small class="help">Skiljer olika talare åt och märker dem SPEAKER_01, SPEAKER_02 osv.</small>
        </p>
      </div>

      <div class="row">
        <!-- Min talare -->
        <p>
          <label for="min_speakers">Min talare (valfritt)</label>
          <input id="min_speakers" type="number" name="min_speakers" min="1" step="1">
          <small class="help">Ange minsta antal talare om du vet att flera personer pratar.</small>
        </p>

        <!-- Max talare -->
        <p>
          <label for="max_speakers">Max talare (valfritt)</label>
          <input id="max_speakers" type="number" name="max_speakers" min="1" step="1">
          <small class="help">Begränsa högsta antal talare för bättre gissning.</small>
        </p>
      </div>

      
      <!-- Progress-bar -->
      <div id="progress-container" class="progress hidden" aria-live="polite">
        <div class="progress__header">
          <span id="progress-label">Förbereder...</span>
          <span id="progress-percent"></span>
        </div>
        <div class="progress__bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div id="progress-fill" class="progress__fill" style="width:0%"></div>
        </div>
        <div id="progress-note" class="progress__note muted">Laddar upp filen...</div>
      </div>

      <p style="margin-top:1rem">
        <button id="submit-btn" type="submit">Kör transkribering</button>
      </p>
    </form>
  </div>

  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
